-- Bảng LOAIPHONG
CREATE TABLE LOAIPHONG (
    MALOAIROOM   NUMBER PRIMARY KEY,
    SOLOUONGPHONG NUMBER,
    DONGIANGAY   NUMBER,
    ANH          BLOB
);

-- Bảng PHONG
CREATE TABLE PHONG (
    MAPHONG     NUMBER PRIMARY KEY,
    TENPHONG    VARCHAR2(20),
    MALOAIROOM  NUMBER,
    GHICHU      VARCHAR2(1000),
    CONSTRAINT FK_PHONG_LOAIPHONG FOREIGN KEY (MALOAIROOM)
        REFERENCES LOAIPHONG(MALOAIROOM)
);

-- Bảng KHACHHANG
CREATE TABLE KHACHHANG (
    MAKH       NUMBER PRIMARY KEY,
    TENKH      VARCHAR2(20),
    GIOITINH   VARCHAR2(20),
    SDT        VARCHAR2(15),
    NGAYSINH   DATE,
    DIACHI     VARCHAR2(100)
);

-- Bảng NHANVIEN
CREATE TABLE NHANVIEN (
    MANV       NUMBER PRIMARY KEY,
    TENNV      NVARCHAR2(50),
    GIOITINH   NVARCHAR2(5),
    SDT        VARCHAR2(15),
    NGAYSINH   DATE,
    DIACHI     NVARCHAR2(100),
    CHUCVU     NVARCHAR2(20)
);

-- Bảng HOADONTHUEPHONG
CREATE TABLE HOADONTHUEPHONG (
    MAHD      NUMBER PRIMARY KEY,
    MANV      NUMBER,
    MAKH      NUMBER,
    NGAYLAP   DATE,
    TONGTIEN  NUMBER,
    CONSTRAINT FK_HD_NV FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV),
    CONSTRAINT FK_HD_KH FOREIGN KEY (MAKH) REFERENCES KHACHHANG(MAKH)
);

-- Bảng CHITIETHOADON
CREATE TABLE CHITIETHOADON (
    LINE_CHITIETHD NUMBER,
    MAHD           NUMBER,
    MAPHONG        NUMBER,
    GIAPHONG       VARCHAR2(20),
    SONGAYTHUE     NUMBER,
    CONSTRAINT PK_CTHD PRIMARY KEY (LINE_CHITIETHD, MAHD, MAPHONG),
    CONSTRAINT FK_CTHD_HD FOREIGN KEY (MAHD) REFERENCES HOADONTHUEPHONG(MAHD),
    CONSTRAINT FK_CTHD_PHONG FOREIGN KEY (MAPHONG) REFERENCES PHONG(MAPHONG)
);

INSERT INTO LOAIPHONG VALUES (1, 20, 300000, NULL);
INSERT INTO LOAIPHONG VALUES (2, 15, 400000, NULL);
INSERT INTO LOAIPHONG VALUES (3, 10, 500000, NULL);
INSERT INTO LOAIPHONG VALUES (4, 5, 600000, NULL);
INSERT INTO LOAIPHONG VALUES (5, 8, 700000, NULL);
INSERT INTO LOAIPHONG VALUES (6, 12, 800000, NULL);
INSERT INTO LOAIPHONG VALUES (7, 7, 900000, NULL);
INSERT INTO LOAIPHONG VALUES (8, 9, 1000000, NULL);
INSERT INTO LOAIPHONG VALUES (9, 6, 1200000, NULL);
INSERT INTO LOAIPHONG VALUES (10, 4, 1500000, NULL);

INSERT INTO PHONG VALUES (101, 'Phong 101', 1, 'Phong don tang 1');
INSERT INTO PHONG VALUES (102, 'Phong 102', 1, 'Phong doi tang 1');
INSERT INTO PHONG VALUES (103, 'Phong 201', 2, 'Phong VIP tang 2');
INSERT INTO PHONG VALUES (104, 'Phong 202', 2, 'Phong doi tang 2');
INSERT INTO PHONG VALUES (105, 'Phong 301', 3, 'Phong VIP tang 3');
INSERT INTO PHONG VALUES (106, 'Phong 302', 3, 'Phong thuong tang 3');
INSERT INTO PHONG VALUES (107, 'Phong 401', 4, 'Phong VIP tang 4');
INSERT INTO PHONG VALUES (108, 'Phong 402', 5, 'Phong doi view bien');
INSERT INTO PHONG VALUES (109, 'Phong 501', 6, 'Phong gia dinh');
INSERT INTO PHONG VALUES (110, 'Phong 502', 7, 'Phong thuong tang 5');

INSERT INTO KHACHHANG VALUES (1, 'Nguyen Van A', 'Nam', '0911111111', TO_DATE('1990-01-01','YYYY-MM-DD'), 'Ha Noi');
INSERT INTO KHACHHANG VALUES (2, 'Tran Thi B', 'Nu', '0922222222', TO_DATE('1992-02-02','YYYY-MM-DD'), 'Hai Phong');
INSERT INTO KHACHHANG VALUES (3, 'Le Van C', 'Nam', '0933333333', TO_DATE('1995-03-03','YYYY-MM-DD'), 'Da Nang');
INSERT INTO KHACHHANG VALUES (4, 'Pham Thi D', 'Nu', '0944444444', TO_DATE('1998-04-04','YYYY-MM-DD'), 'Ho Chi Minh');
INSERT INTO KHACHHANG VALUES (5, 'Hoang Van E', 'Nam', '0955555555', TO_DATE('1989-05-05','YYYY-MM-DD'), 'Can Tho');
INSERT INTO KHACHHANG VALUES (6, 'Do Thi F', 'Nu', '0966666666', TO_DATE('1993-06-06','YYYY-MM-DD'), 'Quang Ninh');
INSERT INTO KHACHHANG VALUES (7, 'Pham Van G', 'Nam', '0977777777', TO_DATE('1988-07-07','YYYY-MM-DD'), 'Hue');
INSERT INTO KHACHHANG VALUES (8, 'Tran Van H', 'Nam', '0988888888', TO_DATE('1991-08-08','YYYY-MM-DD'), 'Nha Trang');
INSERT INTO KHACHHANG VALUES (9, 'Nguyen Thi I', 'Nu', '0999999999', TO_DATE('1994-09-09','YYYY-MM-DD'), 'Vinh');
INSERT INTO KHACHHANG VALUES (10, 'Le Thi K', 'Nu', '0900000000', TO_DATE('1996-10-10','YYYY-MM-DD'), 'Nam Dinh');

INSERT INTO NHANVIEN VALUES (1, 'Nguyen Van NV1', 'Nam', '0811111111', TO_DATE('1985-01-01','YYYY-MM-DD'), 'Ha Noi', 'Le Tan');
INSERT INTO NHANVIEN VALUES (2, 'Tran Thi NV2', 'Nu', '0822222222', TO_DATE('1987-02-02','YYYY-MM-DD'), 'Hai Duong', 'Thu ngan');
INSERT INTO NHANVIEN VALUES (3, 'Le Van NV3', 'Nam', '0833333333', TO_DATE('1989-03-03','YYYY-MM-DD'), 'Thai Binh', 'Quan ly');
INSERT INTO NHANVIEN VALUES (4, 'Pham Thi NV4', 'Nu', '0844444444', TO_DATE('1990-04-04','YYYY-MM-DD'), 'Ha Nam', 'Buong phong');
INSERT INTO NHANVIEN VALUES (5, 'Hoang Van NV5', 'Nam', '0855555555', TO_DATE('1991-05-05','YYYY-MM-DD'), 'Thanh Hoa', 'Bao ve');
INSERT INTO NHANVIEN VALUES (6, 'Do Thi NV6', 'Nu', '0866666666', TO_DATE('1992-06-06','YYYY-MM-DD'), 'Nghe An', 'Phuc vu');
INSERT INTO NHANVIEN VALUES (7, 'Pham Van NV7', 'Nam', '0877777777', TO_DATE('1986-07-07','YYYY-MM-DD'), 'Ha Noi', 'Lao cong');
INSERT INTO NHANVIEN VALUES (8, 'Tran Van NV8', 'Nam', '0888888888', TO_DATE('1984-08-08','YYYY-MM-DD'), 'Hai Phong', 'Quan ly');
INSERT INTO NHANVIEN VALUES (9, 'Nguyen Thi NV9', 'Nu', '0899999999', TO_DATE('1993-09-09','YYYY-MM-DD'), 'Ha Noi', 'Le Tan');
INSERT INTO NHANVIEN VALUES (10, 'Le Thi NV10', 'Nu', '0800000000', TO_DATE('1994-10-10','YYYY-MM-DD'), 'Nam Dinh', 'Thu ngan');

INSERT INTO HOADONTHUEPHONG VALUES (1, 1, 1, TO_DATE('2023-01-10','YYYY-MM-DD'), 0);
INSERT INTO HOADONTHUEPHONG VALUES (2, 2, 2, TO_DATE('2023-02-11','YYYY-MM-DD'), 0);
INSERT INTO HOADONTHUEPHONG VALUES (3, 3, 3, TO_DATE('2023-03-12','YYYY-MM-DD'), 0);
INSERT INTO HOADONTHUEPHONG VALUES (4, 4, 4, TO_DATE('2023-04-13','YYYY-MM-DD'), 0);
INSERT INTO HOADONTHUEPHONG VALUES (5, 5, 5, TO_DATE('2023-05-14','YYYY-MM-DD'), 0);
INSERT INTO HOADONTHUEPHONG VALUES (6, 6, 6, TO_DATE('2023-06-15','YYYY-MM-DD'), 0);
INSERT INTO HOADONTHUEPHONG VALUES (7, 7, 7, TO_DATE('2023-07-16','YYYY-MM-DD'), 0);
INSERT INTO HOADONTHUEPHONG VALUES (8, 8, 8, TO_DATE('2023-08-17','YYYY-MM-DD'), 0);
INSERT INTO HOADONTHUEPHONG VALUES (9, 9, 9, TO_DATE('2023-09-18','YYYY-MM-DD'), 0);
INSERT INTO HOADONTHUEPHONG VALUES (10, 10, 10, TO_DATE('2023-10-19','YYYY-MM-DD'), 0);

INSERT INTO CHITIETHOADON VALUES (1, 1, 101, '300000', 2);
INSERT INTO CHITIETHOADON VALUES (2, 2, 102, '300000', 3);
INSERT INTO CHITIETHOADON VALUES (3, 3, 103, '400000', 1);
INSERT INTO CHITIETHOADON VALUES (4, 4, 104, '400000', 2);
INSERT INTO CHITIETHOADON VALUES (5, 5, 105, '500000', 1);
INSERT INTO CHITIETHOADON VALUES (6, 6, 106, '500000', 4);
INSERT INTO CHITIETHOADON VALUES (7, 7, 107, '600000', 2);
INSERT INTO CHITIETHOADON VALUES (8, 8, 108, '700000', 3);
INSERT INTO CHITIETHOADON VALUES (9, 9, 109, '800000', 1);
INSERT INTO CHITIETHOADON VALUES (10, 10, 110, '900000', 2);

select * from CHITIETHOADON


SELECT * FROM KHACHHANG;

SELECT MANV, TENNV, CHUCVU 
FROM NHANVIEN
WHERE GIOITINH = 'Nu';

SELECT P.MAPHONG, P.TENPHONG, L.DONGIANGAY
FROM PHONG P
JOIN LOAIPHONG L ON P.MALOAIROOM = L.MALOAIROOM
WHERE L.DONGIANGAY > 500000;

SELECT P.MAPHONG, P.TENPHONG, L.DONGIANGAY
FROM PHONG P
JOIN LOAIPHONG L ON P.MALOAIROOM = L.MALOAIROOM
WHERE L.DONGIANGAY > 500000;

SELECT H.MAHD, K.TENKH, H.NGAYLAP, H.TONGTIEN
FROM HOADONTHUEPHONG H
JOIN KHACHHANG K ON H.MAKH = K.MAKH;

SELECT K.MAKH, K.TENKH, SUM(C.SONGAYTHUE) AS TONGNGAYTHUE
FROM KHACHHANG K
JOIN HOADONTHUEPHONG H ON K.MAKH = H.MAKH
JOIN CHITIETHOADON C ON H.MAHD = C.MAHD
GROUP BY K.MAKH, K.TENKH;

SELECT K.TENKH
FROM KHACHHANG K
JOIN HOADONTHUEPHONG H ON K.MAKH = H.MAKH
JOIN CHITIETHOADON C ON H.MAHD = C.MAHD
GROUP BY K.TENKH
HAVING SUM(C.SONGAYTHUE) > 5;

SELECT H.MAHD, COUNT(C.MAPHONG) AS SOPHONG, SUM(C.SONGAYTHUE) AS TONGNGAY
FROM HOADONTHUEPHONG H
JOIN CHITIETHOADON C ON H.MAHD = C.MAHD
GROUP BY H.MAHD;

SELECT P.MAPHONG, P.TENPHONG
FROM PHONG P
WHERE P.MAPHONG NOT IN (SELECT DISTINCT MAPHONG FROM CHITIETHOADON);

SELECT N.MANV, N.TENNV, COUNT(H.MAHD) AS SOHOADON
FROM NHANVIEN N
LEFT JOIN HOADONTHUEPHONG H ON N.MANV = H.MANV
GROUP BY N.MANV, N.TENNV;

SELECT SUM(C.SONGAYTHUE * TO_NUMBER(C.GIAPHONG)) AS DOANHTHU
FROM CHITIETHOADON C;
