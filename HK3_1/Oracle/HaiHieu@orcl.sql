-- Bảng LOAIPHONG
CREATE TABLE LOAIPHONG (
    MALOAIROOM   NUMBER PRIMARY KEY,
    SOLOUONGPHONG NUMBER,
    DONGIANGAY   NUMBER,
    ANH          BLOB
);

-- Bảng PHONG
CREATE TABLE PHONG (
    MAPHONG     NUMBER PRIMARY KEY,
    TENPHONG    VARCHAR2(20),
    MALOAIROOM  NUMBER,
    GHICHU      VARCHAR2(1000),
    CONSTRAINT FK_PHONG_LOAIPHONG FOREIGN KEY (MALOAIROOM)
        REFERENCES LOAIPHONG(MALOAIROOM)
);
-- Bảng KHACHHANG
CREATE TABLE KHACHHANG (
    MAKH       NUMBER PRIMARY KEY,
    TENKH      VARCHAR2(20),
    GIOITINH   VARCHAR2(20),
    SDT        VARCHAR2(15),
    NGAYSINH   DATE,
    DIACHI     VARCHAR2(100)
);
-- Bảng NHANVIEN
CREATE TABLE NHANVIEN (
    MANV       NUMBER PRIMARY KEY,
    TENNV      NVARCHAR2(50),
    GIOITINH   NVARCHAR2(5),
    SDT        VARCHAR2(15),
    NGAYSINH   DATE,
    DIACHI     NVARCHAR2(100),
    CHUCVU     NVARCHAR2(20)
);
-- Bảng HOADONTHUEPHONG
CREATE TABLE HOADONTHUEPHONG (
    MAHD      NUMBER PRIMARY KEY,
    MANV      NUMBER,
    MAKH      NUMBER,
    NGAYLAP   DATE,
    TONGTIEN  NUMBER,
    CONSTRAINT FK_HD_NV FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV),
    CONSTRAINT FK_HD_KH FOREIGN KEY (MAKH) REFERENCES KHACHHANG(MAKH)
);
-- Bảng CHITIETHOADON
CREATE TABLE CHITIETHOADON (
    LINE_CHITIETHD NUMBER,
    MAHD           NUMBER,
    MAPHONG        NUMBER,
    GIAPHONG       VARCHAR2(20),
    SONGAYTHUE     NUMBER,
    CONSTRAINT PK_CTHD PRIMARY KEY (LINE_CHITIETHD, MAHD, MAPHONG),
    CONSTRAINT FK_CTHD_HD FOREIGN KEY (MAHD) REFERENCES HOADONTHUEPHONG(MAHD),
    CONSTRAINT FK_CTHD_PHONG FOREIGN KEY (MAPHONG) REFERENCES PHONG(MAPHONG)
);

INSERT INTO LOAIPHONG VALUES (11, 5, 1600000, NULL);
INSERT INTO LOAIPHONG VALUES (12, 6, 1700000, NULL);
INSERT INTO LOAIPHONG VALUES (13, 7, 1800000, NULL);
INSERT INTO LOAIPHONG VALUES (14, 8, 1900000, NULL);
INSERT INTO LOAIPHONG VALUES (15, 9, 2000000, NULL);
INSERT INTO LOAIPHONG VALUES (16, 10, 2200000, NULL);
INSERT INTO LOAIPHONG VALUES (17, 12, 2400000, NULL);
INSERT INTO LOAIPHONG VALUES (18, 15, 2600000, NULL);
INSERT INTO LOAIPHONG VALUES (19, 18, 2800000, NULL);
INSERT INTO LOAIPHONG VALUES (20, 20, 3000000, NULL);

INSERT INTO PHONG VALUES (111, 'Phong 601', 8, 'Phong VIP view bien');
INSERT INTO PHONG VALUES (112, 'Phong 602', 9, 'Phong doi cao cap');
INSERT INTO PHONG VALUES (113, 'Phong 701', 10, 'Phong thuong tang 7');
INSERT INTO PHONG VALUES (114, 'Phong 702', 11, 'Phong don tang 7');
INSERT INTO PHONG VALUES (115, 'Phong 801', 12, 'Phong doi tang 8');
INSERT INTO PHONG VALUES (116, 'Phong 802', 13, 'Phong VIP tang 8');
INSERT INTO PHONG VALUES (117, 'Phong 901', 14, 'Phong VIP gia dinh');
INSERT INTO PHONG VALUES (118, 'Phong 902', 15, 'Phong thuong view song');
INSERT INTO PHONG VALUES (119, 'Phong 1001', 16, 'Phong thuong tang 10');
INSERT INTO PHONG VALUES (120, 'Phong 1002', 17, 'Phong VIP tong thong');


INSERT INTO KHACHHANG VALUES (11, 'Pham Van L', 'Nam', '0911234567', TO_DATE('1987-11-11','YYYY-MM-DD'), 'Ha Noi');
INSERT INTO KHACHHANG VALUES (12, 'Hoang Thi M', 'Nu', '0921234567', TO_DATE('1992-12-12','YYYY-MM-DD'), 'Hai Duong');
INSERT INTO KHACHHANG VALUES (13, 'Nguyen Van N', 'Nam', '0931234567', TO_DATE('1985-06-21','YYYY-MM-DD'), 'Thanh Hoa');
INSERT INTO KHACHHANG VALUES (14, 'Tran Thi O', 'Nu', '0941234567', TO_DATE('1991-09-14','YYYY-MM-DD'), 'Quang Nam');
INSERT INTO KHACHHANG VALUES (15, 'Le Van P', 'Nam', '0951234567', TO_DATE('1993-03-19','YYYY-MM-DD'), 'Da Nang');
INSERT INTO KHACHHANG VALUES (16, 'Pham Thi Q', 'Nu', '0961234567', TO_DATE('1994-07-17','YYYY-MM-DD'), 'Hai Phong');
INSERT INTO KHACHHANG VALUES (17, 'Do Van R', 'Nam', '0971234567', TO_DATE('1990-05-11','YYYY-MM-DD'), 'Nam Dinh');
INSERT INTO KHACHHANG VALUES (18, 'Nguyen Thi S', 'Nu', '0981234567', TO_DATE('1995-08-20','YYYY-MM-DD'), 'Ha Noi');
INSERT INTO KHACHHANG VALUES (19, 'Hoang Van T', 'Nam', '0991234567', TO_DATE('1989-10-25','YYYY-MM-DD'), 'Nghe An');
INSERT INTO KHACHHANG VALUES (20, 'Tran Thi U', 'Nu', '0901234567', TO_DATE('1996-04-30','YYYY-MM-DD'), 'Hue');

INSERT INTO NHANVIEN VALUES (11, 'Nguyen Van NV11', 'Nam', '0811234567', TO_DATE('1980-11-11','YYYY-MM-DD'), 'Ha Noi', 'Quan ly');
INSERT INTO NHANVIEN VALUES (12, 'Tran Thi NV12', 'Nu', '0821234567', TO_DATE('1982-12-12','YYYY-MM-DD'), 'Hai Duong', 'Thu ngan');
INSERT INTO NHANVIEN VALUES (13, 'Le Van NV13', 'Nam', '0831234567', TO_DATE('1983-01-13','YYYY-MM-DD'), 'Thai Binh', 'Bao ve');
INSERT INTO NHANVIEN VALUES (14, 'Pham Thi NV14', 'Nu', '0841234567', TO_DATE('1984-02-14','YYYY-MM-DD'), 'Ha Nam', 'Le Tan');
INSERT INTO NHANVIEN VALUES (15, 'Hoang Van NV15', 'Nam', '0851234567', TO_DATE('1985-03-15','YYYY-MM-DD'), 'Thanh Hoa', 'Buong phong');
INSERT INTO NHANVIEN VALUES (16, 'Do Thi NV16', 'Nu', '0861234567', TO_DATE('1986-04-16','YYYY-MM-DD'), 'Nghe An', 'Phuc vu');
INSERT INTO NHANVIEN VALUES (17, 'Pham Van NV17', 'Nam', '0871234567', TO_DATE('1987-05-17','YYYY-MM-DD'), 'Ha Noi', 'Le Tan');
INSERT INTO NHANVIEN VALUES (18, 'Tran Van NV18', 'Nam', '0881234567', TO_DATE('1988-06-18','YYYY-MM-DD'), 'Hai Phong', 'Quan ly');
INSERT INTO NHANVIEN VALUES (19, 'Nguyen Thi NV19', 'Nu', '0891234567', TO_DATE('1989-07-19','YYYY-MM-DD'), 'Ha Noi', 'Thu ngan');
INSERT INTO NHANVIEN VALUES (20, 'Le Thi NV20', 'Nu', '0801234567', TO_DATE('1990-08-20','YYYY-MM-DD'), 'Nam Dinh', 'Phuc vu');

INSERT INTO HOADONTHUEPHONG VALUES (11, 11, 11, TO_DATE('2023-11-01','YYYY-MM-DD'), 0);
INSERT INTO HOADONTHUEPHONG VALUES (12, 12, 12, TO_DATE('2023-11-02','YYYY-MM-DD'), 0);
INSERT INTO HOADONTHUEPHONG VALUES (13, 13, 13, TO_DATE('2023-11-03','YYYY-MM-DD'), 0);
INSERT INTO HOADONTHUEPHONG VALUES (14, 14, 14, TO_DATE('2023-11-04','YYYY-MM-DD'), 0);
INSERT INTO HOADONTHUEPHONG VALUES (15, 15, 15, TO_DATE('2023-11-05','YYYY-MM-DD'), 0);
INSERT INTO HOADONTHUEPHONG VALUES (16, 16, 16, TO_DATE('2023-11-06','YYYY-MM-DD'), 0);
INSERT INTO HOADONTHUEPHONG VALUES (17, 17, 17, TO_DATE('2023-11-07','YYYY-MM-DD'), 0);
INSERT INTO HOADONTHUEPHONG VALUES (18, 18, 18, TO_DATE('2023-11-08','YYYY-MM-DD'), 0);
INSERT INTO HOADONTHUEPHONG VALUES (19, 19, 19, TO_DATE('2023-11-09','YYYY-MM-DD'), 0);
INSERT INTO HOADONTHUEPHONG VALUES (20, 20, 20, TO_DATE('2023-11-10','YYYY-MM-DD'), 0);

INSERT INTO CHITIETHOADON VALUES (11, 11, 111, '1600000', 1);
INSERT INTO CHITIETHOADON VALUES (12, 12, 112, '1700000', 2);
INSERT INTO CHITIETHOADON VALUES (13, 13, 113, '1800000', 3);
INSERT INTO CHITIETHOADON VALUES (14, 14, 114, '1900000', 1);
INSERT INTO CHITIETHOADON VALUES (15, 15, 115, '2000000', 2);
INSERT INTO CHITIETHOADON VALUES (16, 16, 116, '2200000', 3);
INSERT INTO CHITIETHOADON VALUES (17, 17, 117, '2400000', 1);
INSERT INTO CHITIETHOADON VALUES (18, 18, 118, '2600000', 2);
INSERT INTO CHITIETHOADON VALUES (19, 19, 119, '2800000', 3);
INSERT INTO CHITIETHOADON VALUES (20, 20, 120, '3000000', 1);

SELECT MAKH, TENKH, GIOITINH, SDT, TO_CHAR(NGAYSINH, 'DD/MM/YYYY') AS NGAYSINH, DIACHI
FROM KHACHHANG;

SELECT P.MAPHONG, P.TENPHONG, L.DONGIANGAY
FROM PHONG P
JOIN LOAIPHONG L ON P.MALOAIROOM = L.MALOAIROOM
WHERE L.MALOAIROOM = 1;

SELECT L.MALOAIROOM, COUNT(P.MAPHONG) AS SoLuongPhong
FROM LOAIPHONG L
LEFT JOIN PHONG P ON L.MALOAIROOM = P.MALOAIROOM
GROUP BY L.MALOAIROOM;

SELECT MANV, TENNV, SDT, CHUCVU
FROM NHANVIEN
WHERE CHUCVU = N'Lễ tân';

SELECT HD.MAHD, KH.TENKH, HD.NGAYLAP, HD.TONGTIEN
FROM HOADONTHUEPHONG HD
JOIN KHACHHANG KH ON HD.MAKH = KH.MAKH;

SELECT KH.MAKH, KH.TENKH, SUM(HD.TONGTIEN) AS TongChi
FROM KHACHHANG KH
JOIN HOADONTHUEPHONG HD ON KH.MAKH = HD.MAKH
GROUP BY KH.MAKH, KH.TENKH;

SELECT HD.MAHD, KH.TENKH, SUM(CT.SONGAYTHUE) AS TongNgayThue
FROM HOADONTHUEPHONG HD
JOIN CHITIETHOADON CT ON HD.MAHD = CT.MAHD
JOIN KHACHHANG KH ON HD.MAKH = KH.MAKH
GROUP BY HD.MAHD, KH.TENKH;

SELECT MAHD, TONGTIEN
FROM HOADONTHUEPHONG
WHERE TONGTIEN = (SELECT MAX(TONGTIEN) FROM HOADONTHUEPHONG);

SELECT HD.MAHD, KH.TENKH, P.TENPHONG, CT.SONGAYTHUE, CT.GIAPHONG
FROM CHITIETHOADON CT
JOIN HOADONTHUEPHONG HD ON CT.MAHD = HD.MAHD
JOIN PHONG P ON CT.MAPHONG = P.MAPHONG
JOIN KHACHHANG KH ON HD.MAKH = KH.MAKH;

SELECT KH.MAKH, KH.TENKH
FROM KHACHHANG KH
LEFT JOIN HOADONTHUEPHONG HD ON KH.MAKH = HD.MAKH
WHERE HD.MAHD IS NULL;




